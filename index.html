<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Sproochentest Flashcards</title>
<style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #e0f7fa, #ffffff);
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #card-wrapper {
      perspective: 1000px;
      width: 90%;
      max-width: 400px;
      height: 220px;
      margin-top: -1rem;
    }
    .card {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .card-inner {
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.6s ease-in-out;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 2rem;
      padding: 2rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      text-align: center;
      color: #333;
      background: #fff;
    }
    .card-face.back {
      transform: rotateY(180deg);
      background-color: #e3f2fd;
    }
    .card-face.front {
      background-color: #ffffff;
    }
    button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 0.7rem 1.2rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      margin: 1.5rem auto 0;
      cursor: pointer;
      transition: background-color 0.2s ease;
      display: block;
    }
    button:hover {
      background-color: #0056b3;
    }
    select {
      margin-bottom: 1rem;
      font-size: 1rem;
      padding: 0.5rem;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
    }
    .category-Gesondheet { border-color: #2196f3; }
    .category-Famill { border-color: #4caf50; }
    .category-Arbecht { border-color: #ff9800; }
    .category-Sproochentest { border-color: #9c27b0; }
    #progress-container {
      margin-top: 1rem;
      width: 100%;
      max-width: 400px;
    }
    #progress-label {
      margin-bottom: 0.5rem;
      text-align: center;
    }
    #progress-bar-wrapper {
      background-color: #ccc;
      border-radius: 1rem;
      overflow: hidden;
    }
    #progress-bar {
      height: 1rem;
      width: 0%;
      background-color: #007bff;
    }
</style>
</head>
<body>
<h2>üá±üá∫ Sproochentest Flashcards</h2>
<div style="margin: 1rem 0; text-align: center;">
  <label style="margin-bottom: 0.5rem; display: block;">
    <input id="randomToggle" onchange="toggleRandomMode()" type="checkbox"/> üîÄ Random Mode
  </label>
  <select id="categorySelect" onchange="filterByCategory()">
    <option value="Categories">All Categories</option>
  </select>
</div>
<div style="margin: 1rem 0; text-align: center;"></div>
<div id="card-wrapper">
  <div class="card" id="card">
    <div class="card-inner">
      <div style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-size: 2rem; opacity: 0.3;">‚ùÆ</div>
      <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 2rem; opacity: 0.3;">‚ùØ</div>
      <div class="card-face front" id="front">Loading...</div>
      <div class="card-face back" id="back">Loading...</div>
    </div>
  </div>
</div>
<div style="margin: 1rem 0; text-align: center;"></div>
<div id="progress-container">
  <div id="progress-label">Progress: 0 / 0</div>
  <div style="background-color: #ccc; border-radius: 1rem; overflow: hidden;">
    <div id="progress-bar" style="height: 1rem; width: 0%; background-color: #007bff;"></div>
  </div>
</div>
<script>
  let flashcards = [];
  let filteredCards = [];
  let index = 0;
  let randomMode = false;

  const categoryIcons = {
    'Gesondheet': 'ü©∫',
    'Famill': 'üë®‚Äçüë©‚Äçüëß',
    'Arbecht': 'üíº',
    'Sproochentest': 'üá±üá∫'
  };

  async function fetchData() {
    const res = await fetch("https://sheets.googleapis.com/v4/spreadsheets/1QD8T3qsp2djYjXBiOcaSt71WKXvBaYAq0HRg08u3oqA/values/Sheet1?key=AIzaSyDgFZcT-kgdg3aps-p2uCMDAqxTVOHm1Ao");
    const data = await res.json();

    const headers = data.values[0];
    const rows = data.values.slice(1);

    const frontIdx = headers.findIndex(h => h.toLowerCase().includes("front"));
    const backIdx = headers.findIndex(h => h.toLowerCase().includes("back"));
    const catIdx = headers.findIndex(h => h.toLowerCase().includes("category"));

    flashcards = rows.map(row => ({
      Front: row[frontIdx] || "",
      Back: row[backIdx] || "",
      Category: row[catIdx] || ""
    }));

    populateCategories();
    filterByCategory();
  }

  function populateCategories() {
    const select = document.getElementById("categorySelect");
    const categories = ["All", ...new Set(flashcards.map(c => c.Category).filter(Boolean))];
    select.innerHTML = "";
    categories.forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat;
      select.appendChild(opt);
    });
  }

  function updateProgress() {
    const progressLabel = document.getElementById("progress-label");
    const progressBar = document.getElementById("progress-bar");
    const total = filteredCards.length;
    const current = Math.min(index + 1, total);
    progressLabel.textContent = `Progress: ${current} / ${total}`;
    progressBar.style.width = `${(current / total) * 100}%`;
  }

  function showCard() {
    if (filteredCards.length === 0) return;
    const card = filteredCards[index];
    const icon = categoryIcons[card.Category] || '';
    document.getElementById("front").textContent = icon + " " + card.Front;
    document.getElementById("back").textContent = icon + " " + card.Back;
    document.getElementById("card").className = "card category-" + (card.Category || "").replace(/\s+/g, '');
    updateProgress();
  }

  function flipCard() {
    document.getElementById("card").classList.toggle("flipped");
  }

  function nextCard() {
    if (filteredCards.length === 0) return;
    index = (index + 1) % filteredCards.length;
    document.getElementById("card").classList.remove("flipped");
    showCard();
  }

  function prevCard() {
    if (filteredCards.length === 0) return;
    index = (index - 1 + filteredCards.length) % filteredCards.length;
    document.getElementById("card").classList.remove("flipped");
    showCard();
  }

  function filterByCategory() {
    const selected = document.getElementById("categorySelect").value;
    filteredCards = selected === "All" ? [...flashcards] : flashcards.filter(c => c.Category === selected);
    if (randomMode) shuffle(filteredCards);
    index = 0;
    showCard();
  }

  function toggleRandomMode() {
    randomMode = document.getElementById("randomToggle").checked;
    filterByCategory();
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  document.getElementById("card-wrapper").addEventListener("click", function(e) {
    const bounds = this.getBoundingClientRect();
    const clickX = e.clientX - bounds.left;
    const width = bounds.width;
    const third = width / 3;

    if (clickX < third) {
      prevCard();
    } else if (clickX > 2 * third) {
      nextCard();
    } else {
      flipCard();
    }
  });

  fetchData();
</script>
</body>
</html>
